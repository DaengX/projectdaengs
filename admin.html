<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Pendataan XI TSM B</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-user-shield"></i>
                <h1>Admin Panel</h1>
            </div>
            <p class="subtitle">Sistem Pendataan Ulangan XI TSM B</p>
        </div>

        <!-- ADMIN PANEL langsung ditampilkan -->
        <div id="adminPanel" class="admin-panel">
            <div class="admin-header">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard Admin</h2>
                <button class="btn btn-secondary" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>

            <!-- STATS -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(45deg, #4361ee, #3a0ca3);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalSiswa">0</h3>
                        <p>Total Siswa</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(45deg, #4cc9f0, #4895ef);">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalMapel">0</h3>
                        <p>Pelaporan Mapel</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(45deg, #7209b7, #3a0ca3);">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="lastUpdate">-</h3>
                        <p>Update Terakhir</p>
                    </div>
                </div>
            </div>

            <!-- DATA TABLE -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-table"></i> Data Siswa</h3>
                    <div>
                        <button class="btn btn-small" onclick="refreshData()" style="margin-right: 10px;">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                        <button class="btn btn-small btn-danger" onclick="clearAllData()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Siswa</th>
                                <th>Mapel Belum Dikerjakan</th>
                                <th>Waktu Submit</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- REPORT GENERATOR -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-file-export"></i> Generator Laporan</h3>
                    <button class="btn btn-primary" onclick="generateLaporan()">
                        <i class="fas fa-magic"></i> Generate Laporan Otomatis
                    </button>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-edit"></i> Format Laporan</label>
                    <select id="formatLaporan" onchange="generateLaporan()">
                        <option value="1">Format 1: Nama — Mapel</option>
                        <option value="2">Format 2: Nama: [Nama] Belum mengerjakan: [Mapel]</option>
                        <option value="3">Format 3: Berurutan dengan angka</option>
                        <option value="4">Format 4: Untuk WhatsApp</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-clipboard"></i> Hasil Laporan (Siap Copy)</label>
                    <textarea id="hasilLaporan" rows="8" placeholder="Hasil laporan akan muncul di sini..." readonly></textarea>
                </div>

                <div class="form-actions">
                    <button class="btn btn-success" onclick="copyLaporan()">
                        <i class="fas fa-copy"></i> Copy ke Clipboard
                    </button>
                    <button class="btn btn-secondary" onclick="clearLaporan()">
                        <i class="fas fa-trash"></i> Hapus Laporan
                    </button>
                    <button class="btn btn-info" onclick="downloadLaporan()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>

            <div class="footer">
                <p><i class="fas fa-database"></i> Data tersimpan di Google Spreadsheet</p>
                <p class="timestamp" id="currentTime"></p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Fungsi tambahan untuk admin
        function clearAllData() {
            if (confirm('⚠️ HAPUS SEMUA DATA? Tindakan ini tidak dapat dibatalkan!')) {
                // Hanya menghapus data di localStorage, karena data utama di Google Sheets
                localStorage.removeItem('siswaDataBackup');
                siswaData = [];
                renderTabel([]);
                document.getElementById('totalSiswa').textContent = '0';
                document.getElementById('totalMapel').textContent = '0';
                document.getElementById('hasilLaporan').value = '';
                alert('✅ Semua data lokal telah dihapus!');
            }
        }
        
        function refreshData() {
            loadSiswaData();
        }
        
        function downloadLaporan() {
            const textarea = document.getElementById('hasilLaporan');
            if (!textarea.value.trim()) {
                alert('⚠️ Tidak ada laporan untuk diunduh!');
                return;
            }
            
            const blob = new Blob([textarea.value], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `laporan-siswa-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            alert('✅ Laporan berhasil diunduh!');
        }
        
        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                `Terakhir update: ${now.toLocaleString('id-ID')}`;
        }
        
        // Initialize admin page
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 60000);
            
            // Load data saat pertama kali dibuka
            loadSiswaData();
        });
    </script>
</body>
</html
